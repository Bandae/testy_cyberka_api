import{_ as R,r as m,o as r,c as a,a as o,w as _,v as f,b as x,F as b,d as I,t as v,e as g,A as S,p as D,S as E,u as U,s as W,f as w,g as B,h as y,i as F,j as A,k as O,l as V,m as N,n as Y}from"./index.8a97678d.js";import{R as j,D as L,E as P}from"./ReviewComponent.4293669d.js";const q={name:"EditMovieComponent",props:["movie"],emits:["close-form"],async setup(l,{emit:t}){const s=l.movie,e=m([]);async function d(){for(;e.value.length;)e.value.pop();try{await S(!0).patch(`movie/${s.id}/`,{title_pl:s.title_pl,title_eng:s.title_eng,year:s.year,runtime:s.runtime,director:s.director,writer:s.writer}),t("close-form")}catch(c){e.value=D(c)}}return{movie:s,editMovie:d,errors:e}}},z=o("label",{for:"title_pl-input"},"Title pl",-1),G=o("label",{for:"title_eng-input"},"Title eng",-1),H=o("label",{for:"year-input"},"Year",-1),J=o("label",{for:"runtime-input"},"Runtime",-1),K=o("label",{for:"director-input"},"Director",-1),Q=o("label",{for:"writer-input"},"Writer",-1),X=o("button",{type:"submit"},"Accept edits",-1),Z={key:0,class:"errors"};function $(l,t,s,e,d,c){return r(),a("div",null,[o("form",{onSubmit:t[6]||(t[6]=x((...i)=>e.editMovie&&e.editMovie(...i),["prevent"]))},[z,_(o("input",{type:"text",id:"title_pl-input","onUpdate:modelValue":t[0]||(t[0]=i=>e.movie.title_pl=i)},null,512),[[f,e.movie.title_pl]]),G,_(o("input",{type:"text",id:"title_eng-input","onUpdate:modelValue":t[1]||(t[1]=i=>e.movie.title_eng=i)},null,512),[[f,e.movie.title_eng]]),H,_(o("input",{type:"text",id:"year-input","onUpdate:modelValue":t[2]||(t[2]=i=>e.movie.year=i)},null,512),[[f,e.movie.year]]),J,_(o("input",{type:"text",id:"runtime-input","onUpdate:modelValue":t[3]||(t[3]=i=>e.movie.runtime=i)},null,512),[[f,e.movie.runtime]]),K,_(o("input",{type:"text",id:"director-input","onUpdate:modelValue":t[4]||(t[4]=i=>e.movie.director=i)},null,512),[[f,e.movie.director]]),Q,_(o("input",{type:"text",id:"writer-input","onUpdate:modelValue":t[5]||(t[5]=i=>e.movie.writer=i)},null,512),[[f,e.movie.writer]]),X],32),e.errors.length?(r(),a("div",Z,[o("ul",null,[(r(!0),a(b,null,I(e.errors,i=>(r(),a("li",null,v(i),1))),256))])])):g("",!0)])}const ee=R(q,[["render",$]]);const oe={name:"WriteReviewComponent",components:{StarIcon:E},props:["movieId"],setup(l){const t=U(),{username:s,loggedIn:e}=W(t),d=m([]),c=m("10"),i=m("");async function n(){for(;d.value.length;)d.value.pop();if(e.value!==!0){d.value.push("You need to log in to post reviews.");return}try{await S(!0).post("reviews/",{movie:l.movieId,rating_value:c.value,body:i.value}),window.location.reload()}catch(u){d.value=D(u)}}return{rating_value:c,body:i,errors:d,handleSubmit:n}}},T=l=>(F("data-v-c45fb26c"),l=l(),A(),l),te={class:"review-form-container"},ie={class:"edit-stars"},ne=["value","id"],re=["for"],le=T(()=>o("label",{for:"body-input"},"Text",-1)),se=T(()=>o("button",{type:"submit"},"Add review",-1)),ae={key:0,class:"errors"};function de(l,t,s,e,d,c){const i=w("StarIcon");return r(),a("div",null,[o("div",te,[o("form",{onSubmit:t[2]||(t[2]=x((...n)=>e.handleSubmit&&e.handleSubmit(...n),["prevent"]))},[o("div",ie,[(r(),a(b,null,I(10,n=>(r(),a(b,{key:n},[_(o("input",{type:"radio",name:"newstar",value:n,id:`newstar${n}`,"onUpdate:modelValue":t[0]||(t[0]=u=>e.rating_value=u)},null,8,ne),[[B,e.rating_value]]),o("label",{for:`newstar${n}`},[y(i)],8,re)],64))),64))]),le,_(o("textarea",{id:"body-input","onUpdate:modelValue":t[1]||(t[1]=n=>e.body=n)},null,512),[[f,e.body]]),se],32),e.errors.length?(r(),a("div",ae,[o("ul",null,[(r(!0),a(b,null,I(e.errors,n=>(r(),a("li",null,v(n),1))),256))])])):g("",!0)])])}const ve=R(oe,[["render",de],["__scopeId","data-v-c45fb26c"]]);const ce={name:"MovieDetailView",components:{EditMovieComponent:ee,ReviewComponent:j,WriteReviewComponent:ve,DeleteIcon:L,EditIcon:P,StarIcon:E},async setup(){const t=O().params.id,s=m(!1),e=U(),{loggedIn:d,is_staff:c}=W(e),i=m(!1),n=m(!1);async function u(){return(await S(!0).get(`movie/${t}`)).data}const h=m(await u());async function C(){await S(!0).delete(`movie/${h.value.id}/`),window.location.reload()}return i.value=d.value&&c.value,{movie:h,ReviewFormIsOpen:s,id:t,allow_movie_editing:i,deleteMovie:C,edit_form_is_open:n,loggedIn:d}}},M=l=>(F("data-v-bd95403f"),l=l(),A(),l),_e={class:"container-all"},me={class:"movie-container"},ue={key:0,class:"edit-delete-functions"},pe={key:2,class:"info-container"},fe=M(()=>o("img",{src:Y,alt:""},null,-1)),we={class:"main-info"},ye={class:"vote-info"},be={class:"secondary-info"},ge={class:"movie-description"},he=M(()=>o("br",null,null,-1)),Ie={class:"write-review-container"},Se=M(()=>o("div",null,[o("span",{class:"triangle"}),o("h2",null,"User Reviews")],-1)),Ce=["disabled"],Re={class:"reviews-container"};function Me(l,t,s,e,d,c){const i=w("EditIcon"),n=w("DeleteIcon"),u=w("EditMovieComponent"),h=w("StarIcon"),C=w("WriteReviewComponent"),k=w("ReviewComponent");return r(),a("div",_e,[o("div",me,[e.allow_movie_editing?(r(),a("div",ue,[o("button",{class:"icon-button",onClick:t[0]||(t[0]=p=>e.edit_form_is_open=!e.edit_form_is_open)},[y(i)]),o("button",{class:"icon-button",onClick:t[1]||(t[1]=(...p)=>e.deleteMovie&&e.deleteMovie(...p))},[y(n)])])):g("",!0),e.edit_form_is_open?(r(),V(u,{key:1,class:"movie-edit-form-container",movie:e.movie,onCloseForm:t[2]||(t[2]=p=>e.edit_form_is_open=!1)},null,8,["movie"])):g("",!0),e.edit_form_is_open?g("",!0):(r(),a("div",pe,[fe,o("div",null,[o("div",null,[o("div",null,[o("h3",null,v(e.movie.title_pl),1),o("div",we,[o("h4",null,v(e.movie.title_eng),1),o("h4",null,v(e.movie.year),1),o("h4",null,v(e.movie.runtime)+"min",1)])]),o("div",ye,[y(h),o("div",null,[o("h5",null,v(e.movie.avg_rating),1),o("p",null,v(e.movie.review_amount)+" reviews",1)])]),o("div",be,[o("div",ge,v(e.movie.description),1),o("div",null,"Director: "+v(e.movie.director)+" Writer: "+v(e.movie.writer),1)])])])])),he,o("div",Ie,[Se,o("button",{onClick:t[3]||(t[3]=p=>e.ReviewFormIsOpen=!e.ReviewFormIsOpen),disabled:!e.loggedIn}," Write review ",8,Ce)])]),_(y(C,{"movie-id":e.id},null,8,["movie-id"]),[[N,e.ReviewFormIsOpen]]),o("div",Re,[(r(!0),a(b,null,I(e.movie.movie_reviews,p=>(r(),V(k,{key:p.id,review:p},null,8,["review"]))),128))])])}const xe=R(ce,[["render",Me],["__scopeId","data-v-bd95403f"]]);export{xe as default};
